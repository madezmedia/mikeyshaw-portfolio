---
import { UX_CONFIG } from '../utils/ux';

interface GitHubStats {
    totalContributions: number;
    longestStreak: number;
    languages: Array<{
        name: string;
        percentage: number;
        color: string;
    }>;
    repositories: Array<{
        name: string;
        stars: number;
        language: string;
    }>;
}

const githubUsername = 'madezmedia';

const mockGitHubStats: GitHubStats = {
    totalContributions: 1247,
    longestStreak: 42,
    languages: [
        { name: 'TypeScript', percentage: 45, color: '#2B7489' },
        { name: 'JavaScript', percentage: 30, color: '#F1E05A' },
        { name: 'Python', percentage: 15, color: '#3572A5' },
        { name: 'HTML', percentage: 10, color: '#E34C26' }
    ],
    repositories: [
        { name: 'Favor-AI', stars: 42, language: 'TypeScript' },
        { name: 'Repubot', stars: 28, language: 'JavaScript' },
        { name: 'Portfolio', stars: 15, language: 'Astro' }
    ]
};

const fetchGitHubStats = async (): Promise<GitHubStats> => {
    try {
        // Placeholder for actual GitHub API fetch
        return mockGitHubStats;
    } catch (error) {
        console.error('GitHub Stats Fetch Error:', error);
        return mockGitHubStats;
    }
};

const githubStats = await fetchGitHubStats();
---

<section class="github-stats-section">
    <div class="github-stats-header">
        <h2 class="section-title">GitHub Insights</h2>
        <p class="section-subtitle">Coding Journey & Technical Landscape</p>
    </div>

    <div class="github-stats-grid">
        <div class="stats-overview">
            <div class="stat-card contributions">
                <span class="stat-icon">üöÄ</span>
                <div class="stat-content">
                    <h3>{githubStats.totalContributions}</h3>
                    <p>Total Contributions</p>
                </div>
            </div>

            <div class="stat-card streak">
                <span class="stat-icon">üî•</span>
                <div class="stat-content">
                    <h3>{githubStats.longestStreak}</h3>
                    <p>Longest Streak (Days)</p>
                </div>
            </div>
        </div>

        <div class="language-breakdown">
            <h3 class="section-subtitle">Language Proficiency</h3>
            <div class="language-chart">
                {githubStats.languages.map((lang) => (
                    <div 
                        class="language-bar" 
                        style={`
                            width: ${lang.percentage}%; 
                            background-color: ${lang.color};
                        `}
                        title={`${lang.name}: ${lang.percentage}%`}
                    >
                        <span class="language-label">{lang.name}</span>
                    </div>
                ))}
            </div>
        </div>

        <div class="top-repositories">
            <h3 class="section-subtitle">Featured Repositories</h3>
            <div class="repo-list">
                {githubStats.repositories.map((repo) => (
                    <div class="repo-card">
                        <div class="repo-header">
                            <h4>{repo.name}</h4>
                            <span class="repo-stars">‚≠ê {repo.stars}</span>
                        </div>
                        <span class="repo-language">{repo.language}</span>
                    </div>
                ))}
            </div>
        </div>
    </div>

    <div class="github-profile-link">
        <a 
            href={`https://github.com/${githubUsername}`} 
            target="_blank" 
            rel="noopener noreferrer"
            class="profile-link"
        >
            Explore Full GitHub Profile
        </a>
    </div>
</section>

<style define:vars={{
    transitionDuration: `${UX_CONFIG.TRANSITION_DURATION}ms`
}}>
    .github-stats-section {
        max-width: 1200px;
        margin: 4rem auto;
        padding: 2rem;
        background: linear-gradient(
            135deg, 
            color-mix(in srgb, var(--bg-primary) 90%, transparent),
            color-mix(in srgb, var(--bg-secondary) 90%, transparent)
        );
        border-radius: 16px;
        border: 1px solid color-mix(in srgb, var(--accent) 20%, transparent);
        box-shadow: 
            0 15px 30px color-mix(in srgb, var(--accent) 10%, transparent),
            0 10px 20px color-mix(in srgb, var(--accent) 5%, transparent);
        transition: transform var(--transitionDuration) ease;
    }

    .github-stats-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .section-title {
        font-size: 2.5rem;
        color: var(--primary);
        margin: 0;
        font-family: 'Orbitron', sans-serif;
        background: linear-gradient(
            to right, 
            var(--primary), 
            color-mix(in srgb, var(--primary) 50%, transparent)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .section-subtitle {
        color: var(--text-secondary);
        opacity: 0.7;
        margin-top: 0.5rem;
        text-align: center;
    }

    .github-stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }

    .stats-overview {
        display: flex;
        justify-content: space-between;
        grid-column: 1 / -1;
    }

    .stat-card {
        background: color-mix(in srgb, var(--accent) 10%, transparent);
        border-radius: 12px;
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: transform var(--transitionDuration) ease;
    }

    .stat-card:hover {
        transform: scale(1.05);
    }

    .stat-icon {
        font-size: 3rem;
        opacity: 0.8;
    }

    .stat-content h3 {
        margin: 0;
        font-size: 2rem;
        color: var(--primary);
    }

    .stat-content p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .language-breakdown {
        background: color-mix(in srgb, var(--accent) 10%, transparent);
        border-radius: 12px;
        padding: 1.5rem;
    }

    .language-chart {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        height: 200px;
    }

    .language-bar {
        height: 30px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        padding: 0 0.5rem;
        transition: width var(--transitionDuration) ease;
    }

    .language-label {
        color: white;
        font-size: 0.9rem;
        text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .top-repositories {
        background: color-mix(in srgb, var(--accent) 10%, transparent);
        border-radius: 12px;
        padding: 1.5rem;
    }

    .repo-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .repo-card {
        background: color-mix(in srgb, var(--primary) 10%, transparent);
        border-radius: 8px;
        padding: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: transform var(--transitionDuration) ease;
    }

    .repo-card:hover {
        transform: translateX(10px);
    }

    .repo-header {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .repo-header h4 {
        margin: 0;
        color: var(--primary);
    }

    .repo-stars {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .repo-language {
        color: var(--text-secondary);
        font-size: 0.8rem;
    }

    .github-profile-link {
        display: flex;
        justify-content: center;
        margin-top: 2rem;
    }

    .profile-link {
        background: var(--primary);
        color: var(--bg-primary);
        padding: 0.75rem 1.5rem;
        text-decoration: none;
        border-radius: 8px;
        transition: 
            transform var(--transitionDuration) ease,
            box-shadow var(--transitionDuration) ease;
    }

    .profile-link:hover {
        transform: scale(1.05);
        box-shadow: 
            0 10px 20px color-mix(in srgb, var(--primary) 30%, transparent),
            0 6px 10px color-mix(in srgb, var(--primary) 20%, transparent);
    }

    @media (max-width: 768px) {
        .github-stats-grid {
            grid-template-columns: 1fr;
        }

        .stats-overview {
            flex-direction: column;
            gap: 1rem;
        }
    }
</style>
